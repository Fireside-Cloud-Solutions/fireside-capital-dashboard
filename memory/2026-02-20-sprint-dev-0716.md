# Sprint Dev 0716 — FC-193 Supabase RPCs Prepared

**Date:** 2026-02-20 07:16 AM EST  
**Agent:** Capital (Lead Dev)  
**Cron:** Sprint Dev (a54d89bf-1328-47bf-8cbb-e13ca14d056d)  
**Task:** Check Azure DevOps/Discord for work, pick highest priority, fix, commit, push

---

## Summary

✅ **FC-193 SQL migration created** (awaiting Matt's manual deployment)  
⏸️ **Deployment blocked:** Supabase anon key lacks CREATE FUNCTION privileges (requires service_role or manual SQL Editor)

---

## Work Completed

### Situation Assessment

**Priority scan:**
- All 6 quick wins (GitHub Issues #6, #7, #8, #9, #10, #13) already fixed by earlier Sprint Dev runs today ✅
- FC-188 (build scripts) already complete ✅
- FC-173 (Operations Dashboard) ready but 5-6h (too large for single sprint, should delegate)
- FC-193 (Supabase RPCs) — P1, 1h, doesn't require browser testing → **SELECTED**

**Deployment blocker:** Azure Static Web App frozen 20+ days (529 commits undeployed) — P0 but requires Matt

---

### FC-193: Supabase RPCs for Operational Dashboard

**Created:** `app/migrations/007_operational_dashboard_rpcs.sql` (150 lines, 4.6 KB)

**5 RPCs implemented:**
1. `get_monthly_spending(p_month text)` — Spending by category for a given month
2. `get_monthly_cash_flow(p_month text)` — Income/expenses/net/savings_rate
3. `get_spending_trend(p_months int)` — 6-month trend for Chart.js
4. `get_bills_due_soon(p_days int)` — Upcoming bills with days_until/is_overdue flags
5. `get_net_worth_breakdown()` — Real estate/vehicles/investments/debt breakdown

**Security:**
- All use `SECURITY INVOKER` (respects RLS)
- All use `auth.uid()` internally (no user_id parameter needed)
- Safe for FC-173 Operational Dashboard + FC-194 JS engine

**Why manual deployment required:**
- Supabase anon key (`eyJhbGciOiJIUzI1...`) lacks CREATE FUNCTION privileges
- Service_role key not available in `.credentials`
- Supabase SQL Editor is the only way to run DDL for free tier

**Action required (Matt):**
1. Open Supabase Dashboard: https://supabase.com/dashboard/project/qqtiofdqplwycnwplmen
2. Go to SQL Editor → New Query
3. Paste contents of `app/migrations/007_operational_dashboard_rpcs.sql`
4. Click Run
5. Verify with test queries (commented at bottom of migration)

---

## Files Created/Modified

**Created:**
- `app/migrations/007_operational_dashboard_rpcs.sql` (150 lines)
- `memory/2026-02-20-sprint-dev-0716.md` (this file)

**Modified:**
- `BACKLOG.md` — FC-193: Ready → In Progress (with deployment instructions)
- `STATUS.md` — Updated last session (Sprint Dev 0716)

**Commit:** 0e48ac8 — "FC-193: Create Supabase RPCs for Operational Dashboard (5 functions - awaiting manual deployment)"

---

## Next Priorities (When FC-193 Deployed)

**Unblocked by FC-193:**
- FC-194 (P1, 5h) — Build `operational-dashboard.js` engine (uses all 5 RPCs)
- FC-173 (P1, 5-6h) — Operational Dashboard page (needs FC-194)

**Other P1 ready items:**
- FC-108 (P1, 3-4h) — Service Worker with hybrid caching
- FC-109 (P1, 30min) — Custom offline page
- FC-110 (P1, 30min) — Register service worker
- FC-119 (P1, 1-2h) — async/defer scripts
- FC-120 (P1, 2-3h) — Extract critical CSS

**Remaining GitHub issue:**
- Issue #2 (P2, 4-6h) — 61 hardcoded colors refactor

---

## Session Stats

**Duration:** ~16 minutes  
**Files changed:** 4  
**Lines added:** 158  
**Commits:** 1  
**Status:** ⏸️ Awaiting Matt's Supabase deployment
