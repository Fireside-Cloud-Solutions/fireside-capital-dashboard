const CSRF=function(){const e="csrfToken",t="csrfTokenExpiry";function n(){const n=sessionStorage.getItem(e),o=parseInt(sessionStorage.getItem(t))||0,r=Date.now();if(!n||r>o){const n=function(){const e=new Uint8Array(32);return crypto.getRandomValues(e),Array.from(e,e=>e.toString(16).padStart(2,"0")).join("")}();return sessionStorage.setItem(e,n),sessionStorage.setItem(t,(r+36e5).toString()),n}return n}function o(){return sessionStorage.getItem(e)}function r(e){if(!e)return!1;const n=o();if(!n)return!1;const r=parseInt(sessionStorage.getItem(t))||0;return!(Date.now()>r)&&e===n}function s(e){const t=document.getElementById(e);if(!t)return;const n=t.querySelector('input[name="csrf_token"]');n&&n.remove();const r=document.createElement("input");r.type="hidden",r.name="csrf_token",r.id="csrfToken",r.value=o()||"",t.insertBefore(r,t.firstChild)}function i(){if(!o())return;const e=["assetForm","investmentForm","debtForm","billForm","incomeForm","settingsForm","budgetForm","shareBillForm","emailReviewForm"];e.forEach(e=>{s(e)}),e.length}return n(),{init:n,getToken:o,validateToken:r,addTokenToForm:s,protectAllForms:i,validateForm:function(e){const t=document.getElementById(e);if(!t)return!1;const n=t.querySelector('input[name="csrf_token"]');return!!n&&r(n.value)},requireValidToken:function(){if(!r(o()))throw new Error("CSRF validation failed. Please refresh the page and try again.")},refreshToken:function(){sessionStorage.removeItem(e),sessionStorage.removeItem(t);const o=n();return i(),o},clearToken:function(){sessionStorage.removeItem(e),sessionStorage.removeItem(t)}}}();"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{CSRF.protectAllForms()}):CSRF.protectAllForms();