let currentOnboardingStep=1;const TOTAL_ONBOARDING_STEPS=4;function showOnboardingStep(n){document.querySelectorAll(".onboarding-step").forEach(n=>{n.classList.remove("active")});const e=document.getElementById(`onboardingStep${n}`);if(e){e.classList.add("active"),currentOnboardingStep=n;const o=document.getElementById("onboardingProgress");o&&(n>1&&n<=4?(o.style.display="block",updateOnboardingProgress(n-1)):o.style.display="none")}}function updateOnboardingProgress(n){const e=document.getElementById("onboardingProgressText"),o=document.getElementById("onboardingProgressBar");if(e&&(e.textContent=`Step ${n} of 4`),o){const e=n/4*100;o.style.width=`${e}%`,o.setAttribute("aria-valuenow",e)}}function onboardingGetStarted(){showOnboardingStep(2)}function onboardingSkipWelcome(){showOnboardingStep(5)}async function onboardingContinueProfile(){const n=document.getElementById("onboardingFirstName")?.value||"",e=document.getElementById("onboardingLastName")?.value||"",o=document.getElementById("onboardingEmergencyFund")?.value||1e4;if(currentUser)try{const{error:t}=await sb.from("settings").upsert({user_id:currentUser.id,emergency_fund_goal:parseFloat(o)||1e4});if(n||e){const{error:o}=await sb.auth.updateUser({data:{first_name:n,last_name:e}})}}catch(n){}showOnboardingStep(3)}function onboardingSkipProfile(){showOnboardingStep(3)}function onboardingQuickStartAction(n){const e=bootstrap.Modal.getInstance(document.getElementById("onboardingModal"));let o=!1;try{switch(n){case"connect-bank":"function"==typeof openPlaidLink?(openPlaidLink(),o=!0):alert("Bank connection feature is not yet available. Continuing setup...");break;case"add-asset":"function"==typeof openAssetModal?(openAssetModal(),o=!0):alert("Asset feature is loading. Please try again in a moment.");break;case"add-bill":"function"==typeof openBillModal?(openBillModal(),o=!0):alert("Bills feature is loading. Please try again in a moment.");break;case"add-income":"function"==typeof openIncomeModal?(openIncomeModal(),o=!0):alert("Income feature is loading. Please try again in a moment.")}}catch(n){alert("Something went wrong. Please try again.")}o&&(e&&e.hide(),window.onboardingPendingStep=4)}function onboardingSkipQuickStart(){showOnboardingStep(4)}function onboardingStartTour(){const n=bootstrap.Modal.getInstance(document.getElementById("onboardingModal"));n&&n.hide(),"function"==typeof startFeatureTour?startFeatureTour():onboardingComplete()}function onboardingSkipTour(){showOnboardingStep(5)}async function onboardingComplete(){if(currentUser)try{const{error:n}=await sb.from("settings").upsert({user_id:currentUser.id,onboarding_completed:!0})}catch(n){}const n=bootstrap.Modal.getInstance(document.getElementById("onboardingModal"));n&&n.hide(),"function"==typeof fetchAllDataFromSupabase&&await fetchAllDataFromSupabase(!0),"function"==typeof renderAll&&renderAll()}let onboardingInProgress=!1;function showOnboardingWizard(){const n=document.getElementById("onboardingModal");if(!n)return;if(onboardingInProgress||n.classList.contains("show"))return;onboardingInProgress=!0,currentOnboardingStep=1,showOnboardingStep(1);const e=bootstrap.Modal.getInstance(n);e&&e.dispose(),new bootstrap.Modal(n,{backdrop:"static",keyboard:!1}).show(),n.addEventListener("hidden.bs.modal",()=>{onboardingInProgress=!1},{once:!0})}function resumeOnboardingIfPending(){if(window.onboardingPendingStep){const n=window.onboardingPendingStep;window.onboardingPendingStep=null,setTimeout(()=>{showOnboardingStep(n),bootstrap.Modal.getOrCreateInstance(document.getElementById("onboardingModal")).show()},300)}}document.addEventListener("DOMContentLoaded",()=>{["addAssetModal","addBillModal","addIncomeModal","addDebtModal"].forEach(n=>{const e=document.getElementById(n);e&&e.addEventListener("hidden.bs.modal",resumeOnboardingIfPending)})}),window.addEventListener("modalClosed",resumeOnboardingIfPending);