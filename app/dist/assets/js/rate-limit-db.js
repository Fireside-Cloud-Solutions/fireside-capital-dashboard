const RATE_LIMIT_CONFIG={add_bill:{max:20,windowMinutes:1},add_asset:{max:20,windowMinutes:1},add_debt:{max:20,windowMinutes:1},add_income:{max:20,windowMinutes:1},add_investment:{max:20,windowMinutes:1},plaid_connect:{max:10,windowMinutes:60},email_scan:{max:2,windowMinutes:1},friend_request:{max:10,windowMinutes:60},delete_item:{max:30,windowMinutes:1},update_item:{max:50,windowMinutes:1}};async function checkDatabaseRateLimit(t){const e=RATE_LIMIT_CONFIG[t];if(!e)return!0;const i=window.sb;if(!i)return!0;try{const{data:{user:n},error:a}=await i.auth.getUser();if(a||!n)return!1;const{data:s,error:o}=await i.rpc("check_rate_limit",{p_user_id:n.id,p_operation:t,p_max_requests:e.max,p_window_minutes:e.windowMinutes});return!!o||!0===s}catch(t){return!0}}function showRateLimitError(t,e){const i={add_bill:"bill creation",add_asset:"asset creation",add_debt:"debt creation",add_income:"income creation",add_investment:"investment creation",plaid_connect:"bank connections",email_scan:"email scanning",friend_request:"friend requests",delete_item:"deletions",update_item:"updates"}[t]||t,n=e>=60?`${e/60} hour${e>60?"s":""}`:`${e} minute${e>1?"s":""}`,a=document.createElement("div");a.className="alert alert-warning alert-dismissible fade show position-fixed top-0 start-50 translate-middle-x mt-3",a.style.zIndex="9999",a.style.maxWidth="500px",a.innerHTML=`\n    <i class="bi bi-exclamation-triangle-fill me-2"></i>\n    <strong>Rate limit exceeded</strong><br>\n    Too many ${i} requests. Please wait ${n} and try again.\n    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>\n  `,document.body.appendChild(a),setTimeout(()=>{a.remove()},5e3)}async function withDatabaseRateLimit(t,e,i=null){if(!await checkDatabaseRateLimit(t)){const e=RATE_LIMIT_CONFIG[t];if(showRateLimitError(t,e.windowMinutes),i&&"function"==typeof disableButtonTemporarily){const t=60*e.windowMinutes*1e3;disableButtonTemporarily(i,Math.min(t,1e4),i.innerHTML)}return null}return await e()}async function withHybridRateLimit(t,e,i,n=null){const a=window.rateLimiters?.[t]||window.rateLimiters?.general;if(a&&!a.allow(e)){const t=a.getRemainingTime(e),i=Math.ceil(t/1e3),s=document.createElement("div");return s.className="alert alert-warning alert-dismissible fade show position-fixed top-0 start-50 translate-middle-x mt-3",s.style.zIndex="9999",s.style.maxWidth="500px",s.innerHTML=`\n      <i class="bi bi-hourglass-split me-2"></i>\n      <strong>Please slow down</strong><br>\n      Wait ${i} second${i>1?"s":""} before trying again.\n      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>\n    `,document.body.appendChild(s),setTimeout(()=>s.remove(),3e3),n&&"function"==typeof disableButtonTemporarily&&disableButtonTemporarily(n,t,n.innerHTML),null}return await withDatabaseRateLimit(e,i,n)}"undefined"!=typeof window&&(window.checkDatabaseRateLimit=checkDatabaseRateLimit,window.withDatabaseRateLimit=withDatabaseRateLimit,window.withHybridRateLimit=withHybridRateLimit,window.showRateLimitError=showRateLimitError,window.RATE_LIMIT_CONFIG=RATE_LIMIT_CONFIG);