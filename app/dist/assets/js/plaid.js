let plaidLinkHandler;function initializePlaid(){fetch("/create_link_token").then(n=>n.json()).then(n=>{n.link_token&&createPlaidLinkHandler(n.link_token)}).catch(n=>{})}function createPlaidLinkHandler(n){try{if("undefined"==typeof Plaid)return void disablePlaidButtons();if(plaidLinkHandler=Plaid.create({token:n,onSuccess:(n,i)=>{exchangePublicToken(n)},onExit:(n,i)=>{},onEvent:(n,i)=>{}}),!plaidLinkHandler)throw new Error("Plaid handler initialization failed")}catch(n){disablePlaidButtons(),showPlaidError("Bank connections temporarily unavailable. Please try again later.")}}function disablePlaidButtons(){document.querySelectorAll('[onclick*="openPlaid"], .connect-account-btn').forEach(n=>{n.disabled=!0,n.title="Bank connections temporarily unavailable",n.style.opacity="0.5"})}function showPlaidError(n){}function exchangePublicToken(n){fetch("/exchange_public_token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({public_token:n})}).then(n=>n.json()).then(n=>{n.success}).catch(n=>{})}async function openPlaidLink(){if(window.rateLimiters&&!window.rateLimiters.plaid.allow("openPlaidLink")){const n=window.rateLimiters.plaid.getRemainingTime("openPlaidLink"),i=Math.ceil(n/1e3);return void alert(`Too many Plaid connection attempts. Please wait ${i} seconds.`)}try{if(await window.LazyLoader.loadPlaid(),!plaidLinkHandler&&"undefined"!=typeof Plaid){const n=await fetch("/create_link_token"),i=await n.json();if(!i.link_token)throw new Error("Failed to fetch link token");createPlaidLinkHandler(i.link_token)}if(!plaidLinkHandler)throw new Error("Plaid Link handler not initialized");plaidLinkHandler.open()}catch(n){alert("Unable to connect bank account. Please try again later.")}}window.initializePlaid=initializePlaid,window.openPlaidLink=openPlaidLink;