!function(){"use strict";const t={maxNotifications:20,toastDuration:5e3,categories:{bill_due:{icon:"bi-receipt",color:"#f44e24",label:"Bill"},bill_paid:{icon:"bi-check-circle",color:"#81b900",label:"Bill"},budget_alert:{icon:"bi-exclamation-triangle",color:"#ffc107",label:"Budget"},investment_update:{icon:"bi-graph-up",color:"#81b900",label:"Investment"},connection_added:{icon:"bi-person-plus",color:"#01a4ef",label:"Friends"},connection_removed:{icon:"bi-person-dash",color:"#f44e24",label:"Friends"},system:{icon:"bi-info-circle",color:"#01a4ef",label:"System"}}};function e(){const t=document.getElementById("noNotifications");t&&(t.innerHTML='\n        <i class="bi bi-bell-slash"></i>\n        <p class="mb-1">No notifications yet</p>\n        <small>You\'ll see bill reminders and updates here</small>\n      ')}window.dismissNotification=async function(t,e){e&&e.stopPropagation();try{const{error:e}=await sb.from("notifications").delete().eq("id",t);if(e)throw e;const n=document.querySelector(`[data-notification-id="${t}"]`);n&&(n.style.opacity="0",n.style.transform="translateX(20px)",setTimeout(()=>{if(n.remove(),0===document.getElementById("notificationList").querySelectorAll(".notification-item").length){const t=document.getElementById("noNotifications");t&&t.classList.remove("d-none")}},200)),window.updateNotificationBadge&&await window.updateNotificationBadge()}catch(t){}};const n=window.markAllNotificationsRead;function i(t){let e=document.getElementById("notificationLiveRegion");e||(e=document.createElement("div"),e.id="notificationLiveRegion",e.className="sr-only",e.setAttribute("aria-live","polite"),e.setAttribute("aria-atomic","true"),document.body.appendChild(e)),e.textContent=t,setTimeout(()=>{e.textContent=""},1e3)}function o(){const n=window.loadNotifications;n&&(window.loadNotifications=async function(){!function(){const t=document.getElementById("notificationList");if(!t)return;t.querySelectorAll(".notification-item, .notification-loading").forEach(t=>t.remove());const e=document.createElement("li");e.className="notification-loading",e.innerHTML='\n      <div class="spinner-border text-primary" role="status">\n        <span class="visually-hidden">Loading...</span>\n      </div>\n    ',t.appendChild(e)}();try{await n();const t=document.querySelectorAll(".notification-item");t.forEach(t=>{t.setAttribute("tabindex","0"),t.style.transition="opacity 0.2s ease, transform 0.2s ease"}),i(`${t.length} notification${1!==t.length?"s":""} loaded`),0===t.length&&e()}finally{const t=document.querySelector(".notification-loading");t&&t.remove()}});const o=window.initNotifications;o&&(window.initNotifications=async function(){await o(),window.sb&&window.currentUser&&window.sb.channel("notification-toasts").on("postgres_changes",{event:"INSERT",schema:"public",table:"notifications",filter:`user_id=eq.${window.currentUser.id}`},e=>{e.new&&(function(e){const n=document.querySelector(".notification-toast");n&&n.remove();const i=document.createElement("div");i.className="notification-toast";const o=t.categories[e.type]||t.categories.system;i.innerHTML=`\n      <div class="toast show" role="alert" aria-live="polite" aria-atomic="true">\n        <div class="toast-header">\n          <i class="${o.icon} me-2" style="color: ${o.color};"></i>\n          <strong class="me-auto">${escapeHtml(e.title)}</strong>\n          <button type="button" class="btn-close" aria-label="Close" onclick="this.closest('.notification-toast').remove()"></button>\n        </div>\n        <div class="toast-body">\n          ${escapeHtml(e.body||"")}\n        </div>\n      </div>\n    `,document.body.appendChild(i),setTimeout(()=>{i.style.opacity="0",i.style.transform="translateX(100%)",setTimeout(()=>i.remove(),300)},t.toastDuration),function(){const t=document.getElementById("notificationBell");t&&(t.classList.add("has-unread"),setTimeout(()=>{t.classList.remove("has-unread")},500))}()}(e.new),i(`New notification: ${e.new.title}`))}).subscribe()})}window.markAllNotificationsRead=async function(){n&&await n(),document.querySelectorAll(".notification-item.unread").forEach(t=>t.classList.remove("unread"));const t=document.querySelector(".dropdown-header button");if(t){const e=t.textContent;t.textContent="âœ“ Marked all read",t.style.color="var(--color-success)",setTimeout(()=>{t.textContent=e,t.style.color=""},2e3)}},function t(){if("loading"===document.readyState)return void document.addEventListener("DOMContentLoaded",t);!function(){const t=document.getElementById("notificationList"),e=document.getElementById("notificationBell");t&&e&&(document.addEventListener("keydown",n=>{if(t.classList.contains("show")){if("Escape"===n.key)return n.preventDefault(),e.click(),void e.focus();if("ArrowDown"===n.key||"ArrowUp"===n.key){n.preventDefault();const e=Array.from(t.querySelectorAll(".notification-item"));if(0===e.length)return;const i=document.activeElement,o=e.indexOf(i);let a;a="ArrowDown"===n.key?o<e.length-1?o+1:0:o>0?o-1:e.length-1,e[a].focus()}if("Enter"===n.key){const t=document.activeElement;t.classList.contains("notification-item")&&t.click()}}}),new MutationObserver(()=>{t.querySelectorAll(".notification-item").forEach(t=>{t.hasAttribute("tabindex")||t.setAttribute("tabindex","0")})}).observe(t,{childList:!0,subtree:!0}))}(),o(),e();const n=document.getElementById("notificationBell");n&&!n.hasAttribute("aria-label")&&n.setAttribute("aria-label","View notifications")}()}();