function showError(e,t=""){const n=getFriendlyError(e,t);ToastManager.error(n)}function getFriendlyError(e,t){const n=(e?.message||e||"").toLowerCase();return n.includes("permission denied")||n.includes("rls")?"You don't have permission to perform this action. Please try logging in again.":n.includes("unique constraint")||n.includes("duplicate")?"An item with this name already exists. Please use a different name.":n.includes("not found")?"The requested item could not be found. It may have been deleted.":n.includes("network")||n.includes("fetch failed")?"Network error. Please check your connection and try again.":n.includes("timeout")?"The request took too long. Please try again.":t.includes("save")&&n.includes("column")?"There was a problem saving your data. Some fields may not be supported.":t.includes("delete")?"Unable to delete this item. It may be in use elsewhere.":t.includes("load")||t.includes("fetch")?"Unable to load data. Please refresh the page and try again.":n.length<100&&!n.includes("error")?e?.message||String(e):"Something went wrong. Please try again or contact support if the problem persists."}if("function"==typeof window.saveAsset){const e=window.saveAsset;window.saveAsset=async function(){const t=document.querySelector("#assetModal .btn-primary");LoadingState.buttonStart(t);try{await e(),ToastManager.success("Asset saved successfully!"),LoadingState.buttonEnd(t)}catch(e){throw showError(e,"save asset"),LoadingState.buttonEnd(t),e}}}function setupFormValidation(){document.querySelectorAll('input[type="number"][step="0.01"], input[placeholder*="$"]').forEach(e=>{formatCurrencyInput(e),e.addEventListener("blur",()=>{const t=e.value;if(t&&e.hasAttribute("required")){const n=FormValidation.validateCurrency(t,e.getAttribute("placeholder")||"Amount");n.valid?FormValidation.clearValidation(e):FormValidation.setInvalid(e,n.message)}})}),document.querySelectorAll("input[required], select[required], textarea[required]").forEach(e=>{e.addEventListener("blur",()=>{const t=e.value;if(t&&""!==t.trim())FormValidation.clearValidation(e);else{const t=e.getAttribute("placeholder")||e.getAttribute("name")||"This field";FormValidation.setInvalid(e,`${t} is required`)}})}),document.querySelectorAll('input[type="email"]').forEach(e=>{e.addEventListener("blur",()=>{const t=e.value;if(t){const n=FormValidation.validateEmail(t);n.valid?FormValidation.setValid(e):FormValidation.setInvalid(e,n.message)}})})}function setupModalAutofocus(){document.querySelectorAll(".modal").forEach(e=>{e.addEventListener("shown.bs.modal",()=>{const t=e.querySelector('input:not([type="hidden"]), select, textarea');t&&t.focus()}),e.addEventListener("show.bs.modal",()=>{e.querySelectorAll(".is-valid, .is-invalid").forEach(e=>{FormValidation.clearValidation(e)})})})}function setupDoubleSubmitPrevention(){document.querySelectorAll("form").forEach(e=>{preventDoubleSubmit(e)})}const originalRenderAll=window.renderAll;function safeDisplay(e,t=null){return null==e||""===e?"—":t?t(e):e}"function"==typeof originalRenderAll&&(window.renderAll=async function(){const e=document.getElementById("dataContainer");e&&!e.querySelector(".loading-overlay")&&LoadingState.overlayStart(e,"Loading your financial data...");try{await originalRenderAll(),LoadingState.overlayEnd(e)}catch(t){LoadingState.overlayEnd(e),showError(t,"load data")}});const originalFormatCurrency=window.formatCurrency;"function"==typeof originalFormatCurrency&&(window.formatCurrency=function(e){return null==e?"$0.00":originalFormatCurrency(e)});const originalFormatDate=window.formatDate;function initializeTooltips(){[].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]')).map(function(e){return new bootstrap.Tooltip(e)}),document.querySelectorAll("abbr").forEach(e=>{e.title&&!e.hasAttribute("data-bs-toggle")&&new bootstrap.Tooltip(e)})}function makeTablesResponsive(){document.querySelectorAll("table:not(.table-responsive table)").forEach(e=>{if(!e.closest(".table-responsive")){const t=document.createElement("div");t.className="table-responsive",e.parentNode.insertBefore(t,e),t.appendChild(e)}})}function initializePolishEnhancements(){setupFormValidation(),setupModalAutofocus(),setupDoubleSubmitPrevention(),initializeTooltips(),makeTablesResponsive()}"function"==typeof originalFormatDate&&(window.formatDate=function(e){return e&&null!=e?originalFormatDate(e):"—"}),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",initializePolishEnhancements):initializePolishEnhancements();