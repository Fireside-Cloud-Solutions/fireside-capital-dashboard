# ðŸ”¥ Fireside Capital â€” Full Audit Report

**Date:** January 31, 2025  
**Auditor:** Auditor Agent  
**Scope:** Post-critical-fixes audit of commit `48ed097`  
**Files Reviewed:** All source files in `app/` (10 HTML, 3 JS, 1 CSS, 1 workflow YAML, 1 .env, 1 migration SQL)

---

## Executive Summary

| Severity | Count |
|----------|-------|
| ðŸ”´ Critical | 7 |
| ðŸŸ¡ Warning | 10 |
| ðŸŸ¢ Suggestion | 8 |

**Overall Status: NOT READY FOR PRODUCTION** â€” Seven critical issues must be resolved before this app handles real financial data. The most urgent are secrets exposure and a non-functional deployment.

---

## Part 1: Live Deploy Verification

### ðŸ”´ CRIT-01: Deployment is completely non-functional (404)

The Azure Static Web App at `nice-cliff-05b13880f.azurestaticapps.net` returns **404 Not Found** for all routes.

**Root causes identified (3 compounding issues):**

1. **Git remote is a placeholder** â€” The origin is set to `https://github.com/YOUR_USERNAME/fireside-capital.git` (never configured to the real repo).
   ```
   > git remote -v
   origin  https://github.com/YOUR_USERNAME/fireside-capital.git (fetch)
   ```

2. **No commits on main** â€” The local `main` branch has zero commits. Nothing has been pushed.
   ```
   > git log --oneline
   fatal: your current branch 'main' does not have any commits yet
   ```

3. **Workflow file is in the wrong directory** â€” The GitHub Actions workflow is at `app/.github/workflows/` instead of the repo root `.github/workflows/`. GitHub Actions will never discover it.

4. **GitHub CLI not authenticated** â€” `gh auth status` shows "not logged into any GitHub hosts."

**Fix required:**
```bash
# 1. Move workflow to repo root
mkdir -p .github/workflows
mv app/.github/workflows/azure-static-web-apps-nice-cliff-05b13880f.yml .github/workflows/

# 2. Fix the remote
git remote set-url origin https://github.com/Fireside-Cloud-Solutions/fireside-capital-dashboard.git

# 3. Update app_location in the workflow to point to "app/" subfolder
# Since the repo root contains AGENTS.md, templates/, etc. and HTML is in app/

# 4. Commit, push, and verify the GitHub Action runs
```

---

## Part 2: Security Audit

### ðŸ”´ CRIT-02: Plaid API secrets committed to repository in plaintext

**File:** `app/.env` (line 1-2)
```
PLAID_CLIENT_ID= 685378c94ac5c0002193dc08
PLAID_SECRET= 472f9c1d6b199a2543db686a1d9906
```

These are real Plaid sandbox credentials stored in an unencrypted `.env` file that is **not** gitignored. If this repo were pushed to GitHub, these secrets would be permanently in git history.

**Fix:**
1. Add `.env` to `.gitignore` immediately
2. Rotate these Plaid credentials in the Plaid dashboard
3. Use GitHub Secrets or Azure environment variables for production

---

### ðŸ”´ CRIT-03: server.js logs Plaid secrets to stdout

**File:** `app/assets/js/server.js` (lines 47-48)
```javascript
console.log('PLAID_CLIENT_ID:', process.env.PLAID_CLIENT_ID);
console.log('PLAID_SECRET:', process.env.PLAID_SECRET);
```

This prints credentials to any log aggregator, terminal, or CI/CD output. **Zero tolerance for this in a financial app.**

**Fix:** Delete both lines entirely.

---

### ðŸ”´ CRIT-04: plaid.js logs Plaid access token to browser console

**File:** `app/assets/js/plaid.js` (line 46)
```javascript
console.log('Access token received:', data.access_token);
```

The Plaid access token grants full access to a user's bank account. Logging it to the browser console exposes it to browser extensions, developer tools, and any XSS attack.

**Fix:** Remove the `console.log`. Never log access tokens client-side.

---

### ðŸ”´ CRIT-05: server.js returns Plaid access token to the frontend

**File:** `app/assets/js/server.js` (lines 23-30)
```javascript
app.post('/exchange_public_token', async (req, res) => {
  // ...
  const accessToken = response.data.access_token;
  // Store the access token securely (e.g., in a database)  <-- comment says to store, but...
  res.json({ access_token: accessToken });  // <-- sends it to the browser!
});
```

The Plaid access token should **NEVER** leave the server. It should be stored server-side in a database, keyed to the user. The client should only receive a success/failure status.

**Fix:**
```javascript
app.post('/exchange_public_token', async (req, res) => {
  try {
    const response = await plaidClient.itemPublicTokenExchange({
      public_token: req.body.public_token,
    });
    // TODO: Store accessToken in database, linked to user
    res.json({ success: true });
  } catch (error) {
    res.status(500).json({ error: 'Failed to exchange token' });
  }
});
```

---

### ðŸ”´ CRIT-06: plaid.js `createPlaidLinkHandler()` ignores the link token parameter

**File:** `app/assets/js/plaid.js` (lines 17-20)
```javascript
function createPlaidLinkHandler() {  // <-- no parameter accepted!
  plaidLinkHandler = Plaid.create({
    token: 'YOUR_LINK_TOKEN', // <-- hardcoded placeholder!
```

The function `initializePlaid()` fetches a real link token and calls `createPlaidLinkHandler(data.link_token)` but the function **doesn't accept any parameters**. It uses a hardcoded placeholder `'YOUR_LINK_TOKEN'` instead.

**Fix:**
```javascript
function createPlaidLinkHandler(linkToken) {
  plaidLinkHandler = Plaid.create({
    token: linkToken,
    // ...
  });
}
```

---

### ðŸ”´ CRIT-07: XSS vulnerability â€” user data injected into innerHTML without sanitization

**File:** `app/assets/js/app.js` â€” Multiple render functions

All CRUD table renderers insert user-controlled data directly into `innerHTML` via template literals with **no escaping**:

```javascript
// Line 161 - renderAssets()
tbody.innerHTML = (window.assets || []).map(a => `
    <tr>
        <td>${a.name}</td><td>${a.type}</td>...
    </tr>`).join('');

// Line 226 - renderInvestments()
// Line 286 - renderDebts()
// Line 341 - renderBills()
// Line 393 - renderIncome()
// Line 876 - renderUpcomingPayments()
```

If a user stores a name like `<img src=x onerror=alert(document.cookie)>`, it will execute as JavaScript. While Supabase RLS means a user can only see their own data, this is still a self-XSS vector that could be exploited via crafted data imports or shared accounts.

**Fix:** Add an escape function and use it on all user-supplied values:
```javascript
function escapeHtml(str) {
    const div = document.createElement('div');
    div.textContent = str;
    return div.innerHTML;
}

// Then use: ${escapeHtml(a.name)} instead of ${a.name}
```

---

### âœ… Supabase RLS â€” VERIFIED WORKING

I tested all 8 tables with an unauthenticated anon-key request. All returned **0 rows**:

| Table | Unauthenticated Query Result |
|-------|-----|
| assets | 0 rows âœ… |
| bills | 0 rows âœ… |
| budgets | 0 rows âœ… |
| debts | 0 rows âœ… |
| income | 0 rows âœ… |
| investments | 0 rows âœ… |
| settings | 0 rows âœ… |
| snapshots | 0 rows âœ… |

The migration SQL confirms RLS is enabled on all tables with `USING (auth.uid() = user_id)` and `WITH CHECK (auth.uid() = user_id)` policies. The Supabase anon key in client-side code is the **expected pattern** for Supabase â€” RLS properly prevents unauthorized data access.

### âœ… Supabase queries all filter by user_id

Every query in `fetchAllDataFromSupabase()` uses `.eq('user_id', currentUser.id)`:
```javascript
supabase.from('assets').select('*').eq('user_id', currentUser.id),
supabase.from('investments').select('*').eq('user_id', currentUser.id),
// ... all 7 tables
```

All CRUD operations also include `user_id: currentUser.id` in records. âœ…

### âœ… No references to deleted files

Searched all HTML and JS files for `transactions.js`, `budget.js`, `charts.js`, `authentication.js`, `utility.js` â€” **zero matches found**. The cleanup was complete. âœ…

---

## Part 3: Code Quality Audit

### ðŸŸ¡ WARN-01: 14 debug console.log statements in production code

**File:** `app/assets/js/app.js`

| Line | Statement | Severity |
|------|-----------|----------|
| 110 | `console.log("FETCH: Data fetch successful for all tables.")` | Debug noise |
| 112 | `console.log("1. Data fetch is complete.")` | Debug noise |
| 253 | `console.log("DEBUG: saveInvestment() function was called...")` | Debug leftover |
| 955 | `console.log("INIT: Page loaded, starting initialization.")` | Debug noise |
| 959 | `console.log(\`%cAUTH: Event received: ${event}\`...)` | Auth event logging |
| 999 | `console.log("INIT: Initialization complete.")` | Debug noise |

**Fix:** Remove all `console.log` statements. Keep `console.error` for genuine error handling but wrap in a production check:
```javascript
const DEBUG = false; // Set to true only in development
function debugLog(...args) { if (DEBUG) console.log(...args); }
```

---

### ðŸŸ¡ WARN-02: `openPlaidLink()` called but never defined globally

**File:** All 10 HTML files contain:
```html
<a href="#" onclick="openPlaidLink()"><i class="bi bi-bank2 me-2"></i> Connect a New Account</a>
```

But `openPlaidLink` is defined in `plaid.js` which uses ES Module `export` syntax:
```javascript
export { initializePlaid, openPlaidLink };
```

`plaid.js` is **never loaded** in any HTML file â€” it's not in any `<script>` tag. This means every "Connect a New Account" sidebar link will throw `ReferenceError: openPlaidLink is not defined`.

**Fix:** Either:
- Load `plaid.js` as a `<script type="module">` and expose `openPlaidLink` to `window`, or
- Move `openPlaidLink` into `app.js` and remove the ES module export

---

### ðŸŸ¡ WARN-03: server.js CORS allows all origins

**File:** `app/assets/js/server.js` (line 7)
```javascript
app.use(cors()); // Enable CORS â€” allows ANY origin
```

**Fix:** Restrict to known origins:
```javascript
app.use(cors({ origin: ['https://nice-cliff-05b13880f.azurestaticapps.net', 'http://localhost:3000'] }));
```

---

### ðŸŸ¡ WARN-04: `dataContainer` visibility not applied on most pages

Only `index.html` and `settings.html` have `<div id="dataContainer">` that hides content before login. The other 7 pages (assets, bills, debts, income, investments, budget, reports) display their data tables immediately, even to logged-out users (tables will be empty but layout is exposed).

**Fix:** Wrap the main content area of each page in a `<div id="dataContainer" style="visibility: hidden;">` div.

---

### ðŸŸ¡ WARN-05: `startingBalance` form field is never saved or populated

**File:** `app/investments.html` has:
```html
<input type="number" class="form-control" id="startingBalance" required min="0" step="0.01">
```

But `saveInvestment()` in `app.js` (line 255) does NOT include `startingBalance`:
```javascript
const record = {
    name: f.investmentName.value, type: f.investmentType.value, value: getRaw(f.investmentValue.value),
    monthlyContribution: getRaw(f.monthlyContribution.value), annualReturn: getRaw(f.annualReturn.value),
    nextContributionDate: f.nextContributionDate.value || null, user_id: currentUser.id
};
// Missing: startingBalance: getRaw(f.startingBalance.value)
```

And `openInvestmentModal()` doesn't populate it on edit either.

**Fix:** Add `startingBalance: getRaw(f.startingBalance.value)` to the record, and add `f.startingBalance.value = inv.startingBalance;` in the modal population.

---

### ðŸŸ¡ WARN-06: Dashboard snapshot creation triggers from Reports page

**File:** `app/assets/js/app.js`, `init()` function (around line 1000)
```javascript
if (document.getElementById('netWorthTimelineChart')) {
    updateDashboardCards();  // <-- This upserts a snapshot!
    renderUpcomingPayments();
    renderNetWorthChart();
    generateMonthlyCashFlowChart();
}
```

`reports.html` also has a `<canvas id="netWorthTimelineChart">`. This means loading the Reports page triggers `updateDashboardCards()`, which **writes a daily snapshot** to the database. Snapshot creation should only happen from the dashboard.

**Fix:** Use a more specific check like `document.getElementById('totalInvestments')` or add a `data-page="dashboard"` attribute.

---

### ðŸŸ¡ WARN-07: `renderAdditionalCharts()` Savings Rate is static (same value for all months)

**File:** `app/assets/js/app.js` (around line 560)
```javascript
const savingsData = netLabels.map(() => {
    const totalIncome = income.reduce((sum, i) => sum + parseFloat(i.amount || 0), 0);
    const totalExpenses = spendValues.reduce((sum, amt) => sum + amt, 0);
    return totalIncome > 0 ? Math.round(((totalIncome - totalExpenses) / totalIncome) * 100) : 0;
});
```

This calculates the **same savings rate for every single month** since it uses the same `income` and `spendValues` totals in every iteration (the `() =>` callback ignores the current index/label). The chart shows a flat line.

**Fix:** Calculate per-month income and expenses based on actual dates to show meaningful trends.

---

### ðŸŸ¡ WARN-08: Investment Growth chart uses hardcoded/simulated data

**File:** `app/assets/js/app.js` (around line 580)
```javascript
const investLabels = ['Jun', 'Jul', 'Aug', 'Sep', 'Oct']; // hardcoded months
const startValue = investments.length ? parseFloat(investments[0].value || 0) : 10000;
const investData = investLabels.map((_, i) => Math.round(startValue * Math.pow(1.03, i)));
```

This doesn't use real data â€” it just applies a 3% monthly compound growth from a starting value. The month labels are hardcoded (Jun-Oct) regardless of the current date.

**Fix:** Use actual snapshot data or investment value history over time.

---

### ðŸŸ¡ WARN-09: Missing `staticwebapp.config.json`

The Azure Static Web App has no route configuration file. Without it:
- SPA fallback routing won't work
- No custom error pages
- No security headers configured
- No route restrictions

**Fix:** Create `app/staticwebapp.config.json`:
```json
{
  "navigationFallback": {
    "rewrite": "/index.html",
    "exclude": ["/assets/*"]
  },
  "globalHeaders": {
    "X-Content-Type-Options": "nosniff",
    "X-Frame-Options": "DENY",
    "Content-Security-Policy": "default-src 'self' https://cdn.jsdelivr.net https://qqtiofdqplwycnwplmen.supabase.co https://cdn.plaid.com; script-src 'self' https://cdn.jsdelivr.net https://cdn.plaid.com; style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net"
  }
}
```

---

### ðŸŸ¡ WARN-10: No `.gitignore` file

**Location:** `app/` directory

There is no `.gitignore` file. The following should be excluded:
- `.env` (contains Plaid secrets)
- `node_modules/` (872+ files of dependencies)
- Any local config files

**Fix:** Create `app/.gitignore`:
```
.env
node_modules/
*.log
```

---

## Part 4: Financial Accuracy Audit

### âœ… Net Worth Calculation â€” CORRECT

**File:** `app/assets/js/app.js`, `updateDashboardCards()` (line 850)
```javascript
const totalInv = (window.investments || []).reduce((s, i) => s + getRaw(i.value), 0);
const totalDebt = (window.debts || []).reduce((s, d) => s + getRaw(d.amount), 0);
const totalAssetEquity = (window.assets || []).reduce((s, a) => s + Math.max(0, getRaw(a.value) - getRaw(a.loan)), 0);
const netWorth = totalInv + totalAssetEquity - totalDebt;
```

Formula: **Net Worth = Investments + Asset Equity - Debts** âœ…  
Asset equity correctly uses `Math.max(0, value - loan)` to prevent negative equity. âœ…

### âœ… `getRaw()` Currency Parser â€” CORRECT

```javascript
function getRaw(value) {
  if (typeof value === 'number') return value;
  if (typeof value === 'string') return parseFloat(value.replace(/[^0-9.-]+/g, '')) || 0;
  return 0;
}
```

Handles numbers, currency strings (strips `$` and commas), null/undefined (returns 0). âœ…

### âœ… `formatCurrency()` â€” CORRECT

Uses `Intl.NumberFormat` with USD locale. Industry-standard approach. âœ…

### âœ… Budget funding percentage â€” CORRECT

```javascript
const fundingPercent = needed > 0 ? (assigned / needed) * 100 : (assigned > 0 ? 100 : 0);
```

Handles zero-needed edge case correctly. âœ…

---

## Part 5: HTML/JS Consistency Audit

### âœ… Sidebar navigation â€” CONSISTENT across all 10 pages

All pages have identical sidebar links with correct `class="active"` on the current page. âœ…

### âœ… Script loading order â€” CONSISTENT

All pages load: `supabase-js@2` â†’ `bootstrap.bundle.min.js` â†’ `assets/js/app.js` in that order. âœ…  
Dashboard and Reports also load `chart.js`. âœ…

### âœ… Login/Signup modals â€” Present on all pages

Every HTML file includes `loginModal` and `signupModal` with matching form IDs. âœ…

### âœ… Theme toggle â€” Present on all pages

All pages have `#themeSwitch` checkbox in the sidebar. âœ…

---

## Part 6: Suggestions

### ðŸŸ¢ SUG-01: Deduplicate shared HTML (modals, sidebar, header)

Login/Signup modals, sidebar navigation, and the logged-in/logged-out state UI are copy-pasted across all 10 HTML files. Consider a templating approach or dynamic component loading to reduce duplication and ensure consistency.

---

### ðŸŸ¢ SUG-02: Export button on Reports page has no functionality

**File:** `app/reports.html`
```html
<button class="btn btn-outline-primary ms-3">
    <i class="bi bi-download me-1"></i> Export
</button>
```

No click handler attached. Should either be removed or implemented.

---

### ðŸŸ¢ SUG-03: Add password strength requirements

The signup form accepts any password. Supabase Auth defaults to a 6-character minimum but the UI provides no guidance.

**Suggested fix:** Add `minlength="8"` and a pattern attribute or real-time validation.

---

### ðŸŸ¢ SUG-04: Add input validation for financial fields

Number inputs allow negative values on some forms. While `min="0"` is set on most, the JS `getRaw()` function will accept negative strings.

**Suggested fix:** Add explicit validation before database writes:
```javascript
if (amount < 0) { alert('Amount must be positive'); return; }
```

---

### ðŸŸ¢ SUG-05: Add error boundary for Chart.js rendering

If Chart.js fails to load from the CDN, all chart-dependent code will throw uncaught errors. Wrap chart creation in try/catch blocks.

---

### ðŸŸ¢ SUG-06: Cash flow chart `while` loop has potential for infinite iteration

**File:** `app/assets/js/app.js`, `generateMonthlyCashFlowChart()` (around line 900)
```javascript
while (nextDate < monthStart && nextDate.getFullYear() < today.getFullYear() + 2) {
    try { nextDate = getNextDate(nextDate, item.frequency); } catch { break; }
}
```

The 2-year guard is good, but if `getNextDate` returns the same date (e.g., for an unknown frequency), the inner `while` loop would also run until the year guard triggers. Consider adding an iteration counter.

---

### ðŸŸ¢ SUG-07: Add HTTPS enforcement configuration

When deployed, the Azure Static Web App handles HTTPS by default, but adding explicit `"forceHttps": true` in `staticwebapp.config.json` is a security best practice.

---

### ðŸŸ¢ SUG-08: Consider using `textContent` instead of `innerHTML` for simple text

For elements like `document.getElementById('totalInvestments').textContent = formatCurrency(val)` â€” the code already correctly uses `textContent` for single values. Extend this pattern to table rendering for security.

---

## Summary: Prioritized Fix List

| Priority | Issue | Effort |
|----------|-------|--------|
| ðŸ”´ P0 | CRIT-02: Remove `.env` from repo, add `.gitignore` | 5 min |
| ðŸ”´ P0 | CRIT-03: Delete `console.log` of secrets in `server.js` | 2 min |
| ðŸ”´ P0 | CRIT-04: Delete `console.log` of access token in `plaid.js` | 2 min |
| ðŸ”´ P0 | CRIT-05: Stop returning access token to frontend | 15 min |
| ðŸ”´ P0 | CRIT-06: Fix `createPlaidLinkHandler` parameter bug | 5 min |
| ðŸ”´ P0 | CRIT-07: Add HTML escaping to all `innerHTML` renders | 30 min |
| ðŸ”´ P1 | CRIT-01: Fix git remote, move workflow, commit & deploy | 30 min |
| ðŸŸ¡ P2 | WARN-01: Remove debug console.log statements | 10 min |
| ðŸŸ¡ P2 | WARN-02: Fix `openPlaidLink` not being globally available | 15 min |
| ðŸŸ¡ P2 | WARN-03: Restrict CORS origins | 5 min |
| ðŸŸ¡ P2 | WARN-05: Save `startingBalance` field properly | 10 min |
| ðŸŸ¡ P2 | WARN-09: Add `staticwebapp.config.json` | 15 min |
| ðŸŸ¡ P2 | WARN-10: Create `.gitignore` | 5 min |
| ðŸŸ¡ P3 | WARN-04: Add `dataContainer` to all pages | 20 min |
| ðŸŸ¡ P3 | WARN-06: Fix snapshot creation from reports page | 10 min |
| ðŸŸ¡ P3 | WARN-07/08: Fix static chart data | 1-2 hrs |

---

*Report generated by Auditor Agent â€” Fireside Capital QA*
