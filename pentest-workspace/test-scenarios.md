# Penetration Test Scenarios - Fireside Capital

## Test Environment
- **Target:** https://nice-cliff-05b13880f.2.azurestaticapps.net
- **Test Accounts:**
  - Matt: matt@firesidecloudsolutions.com / vRpBE5387U5G%0
  - Brittany: brittanyslayton1213@gmail.com / FiresideCapital2025!
- **Date:** 2026-02-01
- **Tester:** Auditor (Subagent)

---

## Phase 1: Reconnaissance & Information Gathering

### 1.1 Client-Side Code Analysis
- [x] Examine source HTML for sensitive data exposure
- [x] Check for exposed API keys/credentials
- [x] Review JavaScript for security mechanisms
- [x] Identify authentication implementation
- [x] Map all form inputs and data flows

**Findings:**
- Supabase anon key exposed in `app.js` (line 107) â€” EXPECTED, mitigated by RLS
- XSS protection function `escapeHtml()` implemented
- Client-side validation present but needs server-side verification

### 1.2 Technology Stack Fingerprinting
- **Frontend:** Vanilla JS, Bootstrap 5, Chart.js
- **Backend:** Supabase (PostgreSQL + Auth)
- **Hosting:** Azure Static Web Apps
- **Bank API:** Plaid (sandbox mode)

---

## Phase 2: Authentication & Session Management Testing

### 2.1 Password Policy Enforcement
- [ ] Test weak passwords (< 6 chars)
- [ ] Test password complexity requirements
- [ ] Verify password strength feedback

### 2.2 Brute Force Protection
- [ ] Attempt multiple failed logins
- [ ] Check for rate limiting
- [ ] Verify account lockout mechanisms

### 2.3 Session Security
- [ ] Inspect session cookies (httpOnly, secure, SameSite)
- [ ] Test session timeout
- [ ] Attempt session hijacking
- [ ] Test concurrent sessions

### 2.4 Password Reset Security
- [ ] Test password reset flow
- [ ] Check for token expiration
- [ ] Verify token can't be reused
- [ ] Test account enumeration via reset

---

## Phase 3: Authorization & Access Control

### 3.1 Horizontal Privilege Escalation
**Test:** Can Matt access Brittany's data?

#### Test Cases:
1. **Direct API Manipulation:**
   - Capture Matt's auth token
   - Attempt to query Brittany's bills via Supabase API
   - Expected: RLS blocks access
   
2. **URL Manipulation:**
   - Try to access data via crafted URLs
   - Expected: Client-side + RLS protection

3. **Shared Bill Exploitation:**
   - Create shared bill as Matt
   - Attempt to modify Brittany's share percentage
   - Attempt to delete shared bill as Brittany (non-owner)
   - Expected: Only owner can modify/delete

### 3.2 Vertical Privilege Escalation
- [ ] Attempt to escalate to admin/service role
- [ ] Test SECURITY DEFINER functions for vulnerabilities

---

## Phase 4: Input Validation & XSS Testing

### 4.1 XSS in Form Fields
Test XSS payloads in ALL form fields:

#### Bills Page:
- [ ] Bill name field
- [ ] Type/category dropdown
- [ ] Amount field
- [ ] Notes/description field
- [ ] Custom category creation

#### Assets Page:
- [ ] Asset name
- [ ] Asset type
- [ ] Address field

#### Budget Page:
- [ ] Custom budget item names
- [ ] Category names

#### Settings Page:
- [ ] First name / last name
- [ ] Username
- [ ] Display name

**Test Payloads:**
```
<script>alert('XSS')</script>
<img src=x onerror=alert('XSS')>
<svg/onload=alert('XSS')>
```

### 4.2 HTML Injection
- [ ] Test HTML in text fields
- [ ] Verify output encoding

### 4.3 Script Injection in Notifications
- [ ] Test XSS via notification body
- [ ] Test XSS via bill share invitation

---

## Phase 5: SQL Injection Testing

### 5.1 Direct SQL Injection
Test SQL injection in:
- [ ] Login form (email/password)
- [ ] Search fields
- [ ] Bill name/description
- [ ] Asset name/description
- [ ] Friend search by email

**Test Payloads:**
```
' OR '1'='1
'; DROP TABLE bills--
' UNION SELECT * FROM auth.users--
```

**Expected Result:** Supabase parameterized queries should block all attempts

---

## Phase 6: Business Logic Vulnerabilities

### 6.1 Negative/Invalid Amounts
- [ ] Create bill with negative amount: -$1000
- [ ] Create asset with $0 value
- [ ] Create debt with negative balance
- [ ] Test extremely large numbers (overflow)

### 6.2 Date Manipulation
- [ ] Set future dates (year 9999)
- [ ] Set past dates (year 1900)
- [ ] Invalid date formats

### 6.3 Shared Bill Logic
- [ ] Set split percentage > 100%
- [ ] Set owner_percent + shared_percent != 100%
- [ ] Delete bill while shares are pending
- [ ] Share bill with non-connected user
- [ ] Accept share after bill is deleted

### 6.4 Race Conditions
- [ ] Submit form twice rapidly
- [ ] Create duplicate bills simultaneously
- [ ] Accept/decline share twice

---

## Phase 7: API Security Testing

### 7.1 Direct Supabase API Calls
Test with modified auth tokens:
```javascript
// Capture Matt's token
const { data: { session } } = await sb.auth.getSession();
console.log(session.access_token);

// Attempt to query Brittany's data
fetch('https://qqtiofdqplwycnwplmen.supabase.co/rest/v1/bills?select=*', {
  headers: {
    'apikey': 'ANON_KEY',
    'Authorization': 'Bearer ' + session.access_token
  }
})
```

**Expected:** RLS filters results to only Matt's data

### 7.2 RLS Bypass Attempts
- [ ] Modify user_id in request
- [ ] Tamper with JWT token
- [ ] Test with expired tokens
- [ ] Test with no token (anon access)

### 7.3 UUID Enumeration
- [ ] Attempt to enumerate other users' UUIDs
- [ ] Test predictability of generated UUIDs
- [ ] Attempt to access snapshots by user_id

---

## Phase 8: CSRF Protection

### 8.1 State-Changing Operations
Test CSRF for:
- [ ] Bill creation
- [ ] Bill deletion
- [ ] Asset modification
- [ ] Password change
- [ ] Friend connection

**Test Method:**
Create malicious HTML page:
```html
<form action="https://nice-cliff-05b13880f.2.azurestaticapps.net/api/bills" method="POST">
  <input name="name" value="CSRF Bill">
  <input name="amount" value="999999">
</form>
<script>document.forms[0].submit();</script>
```

**Expected:** Supabase CORS + token validation should block

### 8.2 Cookie Security
- [ ] Check `httpOnly` flag on session cookies
- [ ] Check `secure` flag (HTTPS only)
- [ ] Check `SameSite` attribute

---

## Phase 9: Information Disclosure

### 9.1 Error Messages
- [ ] Trigger errors to check for stack traces
- [ ] SQL errors revealing schema
- [ ] Authentication errors revealing user existence

### 9.2 Debug Mode
- [ ] Check for `DEBUG = true` in production
- [ ] Look for console.log statements exposing data
- [ ] Check for source maps

### 9.3 Comments & Documentation
- [ ] Search HTML source for sensitive comments
- [ ] Check for TODO comments with credentials
- [ ] Look for API documentation URLs

---

## Phase 10: Plaid Integration Security

### 10.1 Token Security
- [ ] Check if Plaid tokens are properly secured
- [ ] Verify token encryption in transit
- [ ] Test token expiration

### 10.2 Sandbox vs Production
- [ ] Verify app is in sandbox mode (not production)
- [ ] Check for exposed production credentials

---

## Phase 11: Friend/Connection Features

### 11.1 Connection Request Spam
- [ ] Send multiple friend requests
- [ ] Test rate limiting on connection requests

### 11.2 Blocked User Bypass
- [ ] Block a user, attempt to share bill
- [ ] Decline connection, attempt to re-request

### 11.3 Notification Flooding
- [ ] Create excessive notifications
- [ ] Test notification cleanup function

---

## Phase 12: File Upload (if applicable)

- [ ] Test for avatar upload vulnerabilities
- [ ] Check file type validation
- [ ] Test file size limits
- [ ] Attempt executable uploads

---

## Test Results Summary Template

| Test ID | Severity | Status | Finding |
|---------|----------|--------|---------|
| AUTH-01 | Critical | PASS/FAIL | Description |
| XSS-01  | High | PASS/FAIL | Description |
| SQLI-01 | Critical | PASS/FAIL | Description |

**Severity Levels:**
- **Critical:** Remote code execution, complete data breach, authentication bypass
- **High:** XSS, privilege escalation, sensitive data exposure
- **Medium:** CSRF, information disclosure, weak session management
- **Low:** Minor information leaks, client-side validation bypass

---

## Proof of Concept Examples

### PoC 1: XSS in Bill Name (if vulnerable)
```javascript
// Step 1: Login as Matt
// Step 2: Create bill with payload
document.getElementById('billName').value = '<script>alert(document.cookie)</script>';
// Step 3: Submit form
// Step 4: Observe if script executes on page load
```

### PoC 2: Cross-User Data Access (if vulnerable)
```javascript
// Step 1: Capture Brittany's user_id
// Step 2: Login as Matt
// Step 3: Modify API request
fetch('https://qqtiofdqplwycnwplmen.supabase.co/rest/v1/bills?user_id=eq.' + brittanyUserId)
// Step 4: Check if Brittany's bills are returned
```

---

## Remediation Priority

1. **Immediate (Critical/High):**
   - Authentication bypass
   - SQL injection
   - Stored XSS
   - Horizontal privilege escalation

2. **Short-term (Medium):**
   - CSRF protection
   - Session security hardening
   - Input validation improvements

3. **Long-term (Low):**
   - Rate limiting enhancements
   - Logging improvements
   - Security headers

---

## Notes

- All tests conducted ethically with provided test accounts
- No production data was harmed
- All findings documented with reproduction steps
- Focus on real security impact, not theoretical vulnerabilities
